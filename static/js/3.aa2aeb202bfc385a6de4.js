webpackJsonp([3],{"9bBU":function(t,e,a){a("mClu");var n=a("FeBl").Object;t.exports=function(t,e,a){return n.defineProperty(t,e,a)}},C4MV:function(t,e,a){t.exports={default:a("9bBU"),__esModule:!0}},Cje2:function(t,e){},bOdI:function(t,e,a){"use strict";e.__esModule=!0;var n,s=a("C4MV"),r=(n=s)&&n.__esModule?n:{default:n};e.default=function(t,e,a){return e in t?(0,r.default)(t,e,{value:a,enumerable:!0,configurable:!0,writable:!0}):t[e]=a,t}},mClu:function(t,e,a){var n=a("kM2E");n(n.S+n.F*!a("+E39"),"Object",{defineProperty:a("evD5").f})},nZco:function(t,e,a){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=a("bOdI"),s=a.n(n),r=(a("NYxO"),{data:function(){return s()({dialog:!1,e1:3,user:{},loadingDailog:!1,qpayData:null,invoiceNumberPub:null,nextBtn:!0,message:null,isPaid:!1,fullscreen:!1,snackbar:!1,loading:!1},"message","Амжилттай төлөгдлөө...")},components:{PaymentBill:a("XeDC").a},computed:{transaction:{get:function(){return this.$store.state.transaction},set:function(t){this.$store.dispatch("setTransaction",t)}},products:function(){return this.$store.state.cartProducts},totalPayment:function(){var t=this;return this.products.reduce(function(e,a){return e+t.changePrice(a)},0)}},methods:{changePrice:function(t){var e=t.price;return t.info&&(e+=t.info_price),e},selectPay:function(t){this.transaction.paymentType=t,this.nextBtn=!1},buyProduct:function(){var t=this;this.snackbar=!0,this.loading=!0,setTimeout(function(){return t.loading=!1,t.snackbar=!1,localStorage.removeItem("giz-cart"),localStorage.removeItem("giz-transaction"),t.$router.push("/")},2e3)},buy:function(){var t=this;t.invoiceNumberPub=null,t.loadingDailog=!0,t.dialog=!0;var e=moment().format("YYMDHmss"),a=Math.floor(111*Math.random())+1,n=invNum.next(""+e+a),s=uuidv4();async.eachSeries(t.products,function(e,a){e.transaction_id=s,e.invoice_no=n,e.transaction_status=1,e.transaction_date=moment().format(),e.firstName=t.transaction.firstName,e.lastName=t.transaction.lastName,e.email=t.transaction.email,e.phone=t.transaction.phone,e.delivery=t.transaction.delivery,e.deliveryPrice=t.transaction.deliveryPrice,e.paymentType=t.transaction.paymentType,e.buyUserId=t.transaction.buyUserId,e.address=t.transaction.address,e.productId=e.id,e.stock=e.stock,e.quantity=e.quantity;var r=fireDb.batch(),i=fireDb.collection("transactions").doc();r.set(i,e),r.commit().then(function(){a()}).catch(function(){a()})},function(e){fireDb.collection("users").doc(t.transaction.buyUserId).update({transaction_last_date:moment().format()}),axios.get("https://us-central1-iibc-d09e7.cloudfunctions.net/app/getQpayInvoice?uid="+n).then(function(e){t.loadingDailog=!1,0==parseInt(e.data.result_code)?(t.qpayData=e.data.json_data,t.qpayData.qPay_url=t.qpayData.qPay_url.replace("http:","https:"),t.invoiceNumberPub=n,fireDb.collection("transactions").where("invoice_no","==",n).onSnapshot(function(e){var a=null;e.docChanges().forEach(function(e){if("modified"===e.type){var n=e.doc.data();2==n.transaction_status&&(t.isPaid=!0,a=n.transaction_id)}}),t.isPaid&&(window.localStorage.removeItem("giz-cart"),t.$store.dispatch("cart/setProducts",[]),t.$router.push("/payment_success?uid="+a))})):1==parseInt(e.data.result_code)?t.message=e.data.result_msg:t.message="An error occurred!"},function(e){t.loadingDailog=!1})})},checkInvoice:function(){var t=this;this.loadingDailog=!0,axios.get("https://us-central1-iibc-d09e7.cloudfunctions.net/app/getCheckInvoice?uid="+this.invoiceNumberPub).then(function(e){t.$store.commit("setSnackbar",{text:e.data.result_msg,show:!0}),t.loadingDailog=!1},function(e){t.loadingDailog=!1})}}}),i={render:function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"cart"},[a("v-stepper",{staticClass:"elevation-1 mb-5",model:{value:t.e1,callback:function(e){t.e1=e},expression:"e1"}},[a("v-stepper-header",[a("v-stepper-step",{attrs:{complete:t.e1>1,step:"1",color:"green"}},[a("small",[t._v("алхам 1")]),t._v("Сагс")]),t._v(" "),a("v-divider"),t._v(" "),a("v-stepper-step",{attrs:{complete:t.e1>2,step:"2",color:"green"}},[a("small",[t._v("алхам 2")]),t._v("Төлбөр")]),t._v(" "),a("v-divider"),t._v(" "),a("v-stepper-step",{attrs:{step:"3",color:"green"}},[a("small",[t._v("алхам 3")]),t._v("Баталгаажуулалт")])],1),t._v(" "),a("v-stepper-items",[a("v-stepper-content",{attrs:{step:"3"}},[a("h2",{staticClass:"my-3 font-weight-light display-1 text-xs-center"},[t._v("Төлбөр баталгаажуулалт")]),t._v(" "),a("v-layout",{staticClass:"mb-5",attrs:{wrap:"",row:""}},[a("v-flex",{attrs:{xs12:"",sm6:"","offset-sm3":""}},[a("h3",{staticClass:"my-2 font-weight-regular title"},[t._v("Төлбөр хийх төрөлөө сонгоно уу")]),t._v(" "),a("v-layout",{staticClass:"mb-1",attrs:{wrap:"",row:""}},[a("v-flex",{staticClass:"pa-3",attrs:{"d-flex":"",xs12:""}},[a("v-card",{class:"qr"===t.transaction.paymentType?"green lighten-3":"",attrs:{hover:""},on:{click:function(e){return t.selectPay("qr")}}},[a("div",{staticClass:"text-xs-center pa-3 title block font-weight-regular"},[t._v("Qpay төлөх")])])],1)],1)],1),t._v(" "),a("v-flex",{attrs:{xs12:"",sm6:"","offset-sm3":""}},[a("h3",{staticClass:"my-2 font-weight-regular title"},[t._v("Захиалгын билл")]),t._v(" "),a("v-divider",{staticClass:"mb-2"}),t._v(" "),a("payment-bill"),t._v(" "),a("v-btn",{staticClass:"mb-3",attrs:{block:"",round:"",dark:"",large:"",color:"green darken-2",loading:t.loading,disabled:t.nextBtn},on:{click:t.buyProduct}},[t._v("Төлбөр төлөх")]),t._v(" "),a("v-btn",{attrs:{block:"",round:"",large:"",to:"/cart/payment"}},[a("v-icon",{attrs:{left:""}},[t._v("arrow_back")]),t._v("Өмнөх алхам руу буцах")],1)],1)],1)],1)],1)],1),t._v(" "),a("v-dialog",{attrs:{persistent:"","max-width":"490"},model:{value:t.dialog,callback:function(e){t.dialog=e},expression:"dialog"}},[t.loadingDailog?a("v-card",{attrs:{color:"green darken-2",dark:""}},[a("v-card-text",[t._v("\n        Уншиж байна. Түр хүлээнэ үү!\n        "),a("v-progress-linear",{staticClass:"mb-0",attrs:{indeterminate:"",color:"white"}})],1)],1):a("v-card",[a("v-card-title",{staticClass:"headline"},[t._v("\n        Qpay-ээр төлбөр хийх\n        "),a("v-spacer"),t._v(" "),a("v-btn",{attrs:{icon:""},on:{click:function(e){t.dialog=!1}}},[a("v-icon",[t._v("close")])],1)],1),t._v(" "),null!=t.qpayData?a("v-card-text",[a("div",{staticClass:"text-xs-center",staticStyle:{width:"100%"}},[a("img",{attrs:{src:"data:image/png;base64,"+t.qpayData.qPay_QRimage,width:"150",height:"150"}})])]):t.loadingDailog?t._e():a("v-card-text",[a("p",[t._v(t._s(t.message))])])],1)],1),t._v(" "),a("v-snackbar",{attrs:{timeout:6e3},model:{value:t.snackbar,callback:function(e){t.snackbar=e},expression:"snackbar"}},[t._v("\n    "+t._s(t.message)+"\n    "),a("v-btn",{attrs:{dark:"",flat:""},on:{click:function(e){t.snackbar=!1}}},[t._v("Хаах")])],1)],1)},staticRenderFns:[]};var o=a("VU/8")(r,i,!1,function(t){a("Cje2")},null,null);e.default=o.exports}});
//# sourceMappingURL=3.aa2aeb202bfc385a6de4.js.map