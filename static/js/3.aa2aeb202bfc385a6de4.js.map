{"version":3,"sources":["webpack:///./node_modules/core-js/library/fn/object/define-property.js","webpack:///./node_modules/babel-runtime/core-js/object/define-property.js","webpack:///./node_modules/babel-runtime/helpers/defineProperty.js","webpack:///./node_modules/core-js/library/modules/es6.object.define-property.js","webpack:///src/pages/cart/checkout.vue","webpack:///./src/pages/cart/checkout.vue?ded6","webpack:///./src/pages/cart/checkout.vue"],"names":["__webpack_require__","$Object","Object","module","exports","it","key","desc","defineProperty","default","__esModule","obj","_defineProperty","_defineProperty2","value","enumerable","configurable","writable","$export","S","F","f","checkout","data","defineProperty_default","dialog","e1","user","loadingDailog","qpayData","invoiceNumberPub","nextBtn","message","isPaid","fullscreen","snackbar","loading","components","PaymentBill","computed","transaction","get","this","$store","state","set","val","dispatch","products","cartProducts","totalPayment","_this","reduce","current","next","changePrice","methods","item","price","info","info_price","selectPay","paymentType","buyProduct","_this2","setTimeout","localStorage","removeItem","$router","push","buy","vm","vdate","moment","format","invoiceSuffix","Math","floor","random","invoiceNO","invNum","transactionUUID","uuidv4","async","eachSeries","product","callback","transaction_id","invoice_no","transaction_status","transaction_date","firstName","lastName","email","phone","delivery","deliveryPrice","buyUserId","address","productId","id","stock","quantity","batch","fireDb","transactionDocRef","collection","doc","commit","then","catch","err","update","transaction_last_date","axios","response","parseInt","result_code","json_data","qPay_url","replace","where","onSnapshot","snapshot","trUid","docChanges","forEach","change","type","mdata","window","result_msg","verror","checkInvoice","_this3","text","show","cart_checkout","render","_vm","_h","$createElement","_c","_self","staticClass","model","$$v","expression","attrs","complete","step","color","_v","wrap","row","xs12","sm6","offset-sm3","d-flex","class","hover","on","click","$event","block","round","dark","large","disabled","to","left","persistent","max-width","indeterminate","icon","staticStyle","width","src","height","_e","_s","timeout","flat","staticRenderFns","Component","normalizeComponent","ssrContext","__webpack_exports__"],"mappings":"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","file":"static/js/3.aa2aeb202bfc385a6de4.js","sourcesContent":["require('../../modules/es6.object.define-property');\nvar $Object = require('../../modules/_core').Object;\nmodule.exports = function defineProperty(it, key, desc) {\n  return $Object.defineProperty(it, key, desc);\n};\n\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./node_modules/core-js/library/fn/object/define-property.js\n// module id = 9bBU\n// module chunks = 3","module.exports = { \"default\": require(\"core-js/library/fn/object/define-property\"), __esModule: true };\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./node_modules/babel-runtime/core-js/object/define-property.js\n// module id = C4MV\n// module chunks = 3","\"use strict\";\n\nexports.__esModule = true;\n\nvar _defineProperty = require(\"../core-js/object/define-property\");\n\nvar _defineProperty2 = _interopRequireDefault(_defineProperty);\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\nexports.default = function (obj, key, value) {\n  if (key in obj) {\n    (0, _defineProperty2.default)(obj, key, {\n      value: value,\n      enumerable: true,\n      configurable: true,\n      writable: true\n    });\n  } else {\n    obj[key] = value;\n  }\n\n  return obj;\n};\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./node_modules/babel-runtime/helpers/defineProperty.js\n// module id = bOdI\n// module chunks = 3","var $export = require('./_export');\n// 19.1.2.4 / 15.2.3.6 Object.defineProperty(O, P, Attributes)\n$export($export.S + $export.F * !require('./_descriptors'), 'Object', { defineProperty: require('./_object-dp').f });\n\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./node_modules/core-js/library/modules/es6.object.define-property.js\n// module id = mClu\n// module chunks = 3","<template>\n  <div class=\"cart\">\n    <v-stepper v-model=\"e1\" class=\"elevation-1 mb-5\">\n      <v-stepper-header>\n        <v-stepper-step :complete=\"e1 > 1\" step=\"1\" color=\"green\"><small>алхам 1</small>Сагс</v-stepper-step>\n        <v-divider></v-divider>\n        <v-stepper-step :complete=\"e1 > 2\" step=\"2\" color=\"green\"><small>алхам 2</small>Төлбөр</v-stepper-step>\n        <v-divider></v-divider>\n        <v-stepper-step step=\"3\" color=\"green\"><small>алхам 3</small>Баталгаажуулалт</v-stepper-step>\n      </v-stepper-header>\n\n      <v-stepper-items>\n        <v-stepper-content step=\"3\">\n          <h2 class=\"my-3 font-weight-light display-1 text-xs-center\">Төлбөр баталгаажуулалт</h2>\n          <v-layout wrap row class=\"mb-5\">\n            <v-flex xs12 sm6 offset-sm3>\n              <h3 class=\"my-2 font-weight-regular title\">Төлбөр хийх төрөлөө сонгоно уу</h3>\n              <v-layout wrap row class=\"mb-1\">\n                <v-flex d-flex xs12 class=\"pa-3\">\n                  <v-card hover @click=\"selectPay('qr')\" :class=\"transaction.paymentType === 'qr' ? 'green lighten-3' : ''\">\n                    <div class=\"text-xs-center pa-3 title block font-weight-regular\">Qpay төлөх</div>\n                  </v-card>\n                </v-flex>\n              </v-layout>\n            </v-flex> \n            <v-flex xs12 sm6 offset-sm3>\n              <h3 class=\"my-2 font-weight-regular title\">Захиалгын билл</h3>\n              <v-divider class=\"mb-2\"/>\n              \n              <payment-bill></payment-bill>\n\n              <v-btn block round dark large color=\"green darken-2\" :loading=\"loading\" :disabled=\"nextBtn\" @click=\"buyProduct\" class=\"mb-3\">Төлбөр төлөх</v-btn>\n              <v-btn block round large to=\"/cart/payment\"><v-icon left>arrow_back</v-icon>Өмнөх алхам руу буцах</v-btn>\n            </v-flex>\n          </v-layout>\n        </v-stepper-content>\n      </v-stepper-items>\n    </v-stepper>\n\n    <v-dialog v-model=\"dialog\" persistent max-width=\"490\">\n      <v-card color=\"green darken-2\" dark v-if=\"loadingDailog\">\n        <v-card-text>\n          Уншиж байна. Түр хүлээнэ үү!\n          <v-progress-linear\n            indeterminate\n            color=\"white\"\n            class=\"mb-0\"\n          ></v-progress-linear>\n        </v-card-text>\n      </v-card>\n      <v-card v-else>\n        <v-card-title class=\"headline\">\n          Qpay-ээр төлбөр хийх\n          <v-spacer />\n          <v-btn icon @click=\"dialog = false\">\n            <v-icon>close</v-icon>\n          </v-btn>\n        </v-card-title>\n        <v-card-text v-if=\"qpayData != null\">\n          <div class=\"text-xs-center\" style=\"width: 100%;\">\n            <img :src=\"`data:image/png;base64,${qpayData.qPay_QRimage}`\" width=\"150\" height=\"150\">\n          </div>\n          \n        </v-card-text>\n        <v-card-text v-else-if=\"!loadingDailog\">\n            <p>{{message}}</p>\n        </v-card-text>\n      </v-card>\n    </v-dialog>\n\n    <v-snackbar v-model=\"snackbar\" :timeout=\"6000\">\n      {{ message }}\n      <v-btn dark flat @click=\"snackbar = false\">Хаах</v-btn>\n    </v-snackbar>\n  </div>\n</template>\n\n<script>\nimport { mapGetters, mapActions } from 'vuex';\nimport PaymentBill from './bill'\n// const moment = require('moment')\n// const async = require(\"async\")\n// const uuidv4 = require('uuid/v4')\n// const invNum = require('invoice-number')\n// import axios from 'axios'\n\nexport default {\n  data() {\n    return {\n      dialog: false,\n      e1: 3,\n      user: {},\n      loadingDailog: false,\n      qpayData: null,\n      invoiceNumberPub: null,\n      nextBtn: true,\n      message: null,\n      isPaid: false,\n      fullscreen: false,\n      snackbar: false,\n      loading: false,\n      message: 'Амжилттай төлөгдлөө...'\n    }\n  },\n  components: {\n    PaymentBill\n  },\n  computed: {\n    transaction: {\n      get() {\n        return this.$store.state.transaction\n      },\n      set(val) {\n        this.$store.dispatch('setTransaction', val)\n      }\n    },\n    products() {\n      return this.$store.state.cartProducts\n    },\n    totalPayment() {\n      return this.products.reduce((current, next) => current + (this.changePrice(next)), 0);\n    }\n  },\n  methods: {\n    changePrice(item) {\n      var price = item.price\n\n      if (item.info) price = price + item.info_price\n\n      return price\n    },\n    selectPay(item) {\n      this.transaction.paymentType = item\n      this.nextBtn = false\n    },\n    buyProduct() {\n      this.snackbar = true\n      this.loading = true\n      setTimeout(() => (\n          this.loading = false,\n          this.snackbar = false,\n          localStorage.removeItem('giz-cart'),\n          localStorage.removeItem('giz-transaction'),\n          this.$router.push('/')\n        ), 2000)\n    },\n    buy() {\n      let vm = this\n      vm.invoiceNumberPub = null\n      vm.loadingDailog = true\n      vm.dialog = true\n      var vdate = moment().format('YYMDHmss')\n      var invoiceSuffix = Math.floor(Math.random() * 111) + 1\n\n      let invoiceNO = invNum.next(`${vdate}${invoiceSuffix}`);\n      let transactionUUID = uuidv4()\n      async.eachSeries(vm.products, function (product, callback) {\n        product.transaction_id = transactionUUID\n        product.invoice_no = invoiceNO\n        product.transaction_status = 1\n        product.transaction_date = moment().format()\n        product.firstName = vm.transaction.firstName\n        product.lastName = vm.transaction.lastName\n        product.email = vm.transaction.email\n        product.phone = vm.transaction.phone\n        product.delivery = vm.transaction.delivery\n        product.deliveryPrice = vm.transaction.deliveryPrice\n        product.paymentType = vm.transaction.paymentType\n        product.buyUserId = vm.transaction.buyUserId\n        product.address = vm.transaction.address\n        product.productId = product.id\n        product.stock = product.stock\n        product.quantity = product.quantity\n\n        var batch = fireDb.batch();\n        var transactionDocRef = fireDb.collection('transactions').doc();\n\n        batch.set(transactionDocRef, product);\n\n        // Commit the batch\n        batch.commit().then(function () {\n          callback()\n        })\n        .catch(function () {\n          callback()          \n        });\n      }, function (err) {\n        if (err) {\n          // console.log('err', err)\n        }\n        fireDb.collection('users').doc(vm.transaction.buyUserId).update({ transaction_last_date: moment().format() });\n\n        axios.get(`https://us-central1-iibc-d09e7.cloudfunctions.net/app/getQpayInvoice?uid=${invoiceNO}`)\n          .then( response => {\n            vm.loadingDailog = false\n            if(parseInt(response.data.result_code) == 0) {\n              vm.qpayData = response.data.json_data\n              vm.qpayData.qPay_url = vm.qpayData.qPay_url.replace(\"http:\", \"https:\")\n              vm.invoiceNumberPub = invoiceNO\n\n              // console.log('invoiceNO', invoiceNO)\n              fireDb.collection('transactions').where('invoice_no', '==', invoiceNO).onSnapshot(function (snapshot) {\n                let trUid = null\n                snapshot.docChanges().forEach(function(change) {\n                    if (change.type === 'modified' ) {\n                      let mdata = change.doc.data()\n                      // console.log(\"mdata: \", mdata);\n                      if(mdata.transaction_status == 2) {\n                        vm.isPaid = true\n                        trUid = mdata.transaction_id\n                      }\n                    } \n                });\n                if(vm.isPaid) {\n                  window.localStorage.removeItem('giz-cart')\n                  vm.$store.dispatch('cart/setProducts', [])\n                  // window.location = `/payment_success?uid=${trUid}`\n                  vm.$router.push( `/payment_success?uid=${trUid}`)\n                }\n              })\n\n            } else if(parseInt(response.data.result_code) == 1) {\n              vm.message = response.data.result_msg\n            } else {\n              vm.message = \"An error occurred!\"\n            }\n          }, verror =>{\n            vm.loadingDailog = false\n          })\n      })\n    },\n    checkInvoice() {\n      this.loadingDailog = true\n      axios.get(`https://us-central1-iibc-d09e7.cloudfunctions.net/app/getCheckInvoice?uid=${this.invoiceNumberPub}`)\n        .then( response => {\n          this.$store.commit(\"setSnackbar\", { text: response.data.result_msg, show: true })\n          this.loadingDailog = false\n        },err =>{\n          this.loadingDailog = false\n        })\n    }\n  }\n}\n</script>\n\n<style>\n.cart .v-stepper__header{\n  box-shadow: none;\n}\n.stock.v-list__tile__action--stack{\n  flex-direction: row;\n  align-items: center;\n  min-width: 100px;\n}\n.stock .v-btn{\n  min-width: 20px;\n  float: left;\n  margin: 0 5px;\n}\n@media (max-width: 600px) {\n  .cart .v-stepper__content{\n    padding: 15px 0;\n  }\n  .cart .v-list__tile__avatar, .cart .remove-btn{\n    min-width: 36px\n  }\n  .cart .v-list__tile{\n    padding: 0 5px;\n  }\n}\n</style>\n\n\n// WEBPACK FOOTER //\n// src/pages/cart/checkout.vue","var render = function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('div',{staticClass:\"cart\"},[_c('v-stepper',{staticClass:\"elevation-1 mb-5\",model:{value:(_vm.e1),callback:function ($$v) {_vm.e1=$$v},expression:\"e1\"}},[_c('v-stepper-header',[_c('v-stepper-step',{attrs:{\"complete\":_vm.e1 > 1,\"step\":\"1\",\"color\":\"green\"}},[_c('small',[_vm._v(\"алхам 1\")]),_vm._v(\"Сагс\")]),_vm._v(\" \"),_c('v-divider'),_vm._v(\" \"),_c('v-stepper-step',{attrs:{\"complete\":_vm.e1 > 2,\"step\":\"2\",\"color\":\"green\"}},[_c('small',[_vm._v(\"алхам 2\")]),_vm._v(\"Төлбөр\")]),_vm._v(\" \"),_c('v-divider'),_vm._v(\" \"),_c('v-stepper-step',{attrs:{\"step\":\"3\",\"color\":\"green\"}},[_c('small',[_vm._v(\"алхам 3\")]),_vm._v(\"Баталгаажуулалт\")])],1),_vm._v(\" \"),_c('v-stepper-items',[_c('v-stepper-content',{attrs:{\"step\":\"3\"}},[_c('h2',{staticClass:\"my-3 font-weight-light display-1 text-xs-center\"},[_vm._v(\"Төлбөр баталгаажуулалт\")]),_vm._v(\" \"),_c('v-layout',{staticClass:\"mb-5\",attrs:{\"wrap\":\"\",\"row\":\"\"}},[_c('v-flex',{attrs:{\"xs12\":\"\",\"sm6\":\"\",\"offset-sm3\":\"\"}},[_c('h3',{staticClass:\"my-2 font-weight-regular title\"},[_vm._v(\"Төлбөр хийх төрөлөө сонгоно уу\")]),_vm._v(\" \"),_c('v-layout',{staticClass:\"mb-1\",attrs:{\"wrap\":\"\",\"row\":\"\"}},[_c('v-flex',{staticClass:\"pa-3\",attrs:{\"d-flex\":\"\",\"xs12\":\"\"}},[_c('v-card',{class:_vm.transaction.paymentType === 'qr' ? 'green lighten-3' : '',attrs:{\"hover\":\"\"},on:{\"click\":function($event){return _vm.selectPay('qr')}}},[_c('div',{staticClass:\"text-xs-center pa-3 title block font-weight-regular\"},[_vm._v(\"Qpay төлөх\")])])],1)],1)],1),_vm._v(\" \"),_c('v-flex',{attrs:{\"xs12\":\"\",\"sm6\":\"\",\"offset-sm3\":\"\"}},[_c('h3',{staticClass:\"my-2 font-weight-regular title\"},[_vm._v(\"Захиалгын билл\")]),_vm._v(\" \"),_c('v-divider',{staticClass:\"mb-2\"}),_vm._v(\" \"),_c('payment-bill'),_vm._v(\" \"),_c('v-btn',{staticClass:\"mb-3\",attrs:{\"block\":\"\",\"round\":\"\",\"dark\":\"\",\"large\":\"\",\"color\":\"green darken-2\",\"loading\":_vm.loading,\"disabled\":_vm.nextBtn},on:{\"click\":_vm.buyProduct}},[_vm._v(\"Төлбөр төлөх\")]),_vm._v(\" \"),_c('v-btn',{attrs:{\"block\":\"\",\"round\":\"\",\"large\":\"\",\"to\":\"/cart/payment\"}},[_c('v-icon',{attrs:{\"left\":\"\"}},[_vm._v(\"arrow_back\")]),_vm._v(\"Өмнөх алхам руу буцах\")],1)],1)],1)],1)],1)],1),_vm._v(\" \"),_c('v-dialog',{attrs:{\"persistent\":\"\",\"max-width\":\"490\"},model:{value:(_vm.dialog),callback:function ($$v) {_vm.dialog=$$v},expression:\"dialog\"}},[(_vm.loadingDailog)?_c('v-card',{attrs:{\"color\":\"green darken-2\",\"dark\":\"\"}},[_c('v-card-text',[_vm._v(\"\\n        Уншиж байна. Түр хүлээнэ үү!\\n        \"),_c('v-progress-linear',{staticClass:\"mb-0\",attrs:{\"indeterminate\":\"\",\"color\":\"white\"}})],1)],1):_c('v-card',[_c('v-card-title',{staticClass:\"headline\"},[_vm._v(\"\\n        Qpay-ээр төлбөр хийх\\n        \"),_c('v-spacer'),_vm._v(\" \"),_c('v-btn',{attrs:{\"icon\":\"\"},on:{\"click\":function($event){_vm.dialog = false}}},[_c('v-icon',[_vm._v(\"close\")])],1)],1),_vm._v(\" \"),(_vm.qpayData != null)?_c('v-card-text',[_c('div',{staticClass:\"text-xs-center\",staticStyle:{\"width\":\"100%\"}},[_c('img',{attrs:{\"src\":(\"data:image/png;base64,\" + (_vm.qpayData.qPay_QRimage)),\"width\":\"150\",\"height\":\"150\"}})])]):(!_vm.loadingDailog)?_c('v-card-text',[_c('p',[_vm._v(_vm._s(_vm.message))])]):_vm._e()],1)],1),_vm._v(\" \"),_c('v-snackbar',{attrs:{\"timeout\":6000},model:{value:(_vm.snackbar),callback:function ($$v) {_vm.snackbar=$$v},expression:\"snackbar\"}},[_vm._v(\"\\n    \"+_vm._s(_vm.message)+\"\\n    \"),_c('v-btn',{attrs:{\"dark\":\"\",\"flat\":\"\"},on:{\"click\":function($event){_vm.snackbar = false}}},[_vm._v(\"Хаах\")])],1)],1)}\nvar staticRenderFns = []\nvar esExports = { render: render, staticRenderFns: staticRenderFns }\nexport default esExports\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./node_modules/vue-loader/lib/template-compiler?{\"id\":\"data-v-06739cd5\",\"hasScoped\":false,\"transformToRequire\":{\"video\":[\"src\",\"poster\"],\"source\":\"src\",\"img\":\"src\",\"image\":\"xlink:href\"},\"buble\":{\"transforms\":{}}}!./node_modules/vue-loader/lib/selector.js?type=template&index=0!./src/pages/cart/checkout.vue\n// module id = null\n// module chunks = ","function injectStyle (ssrContext) {\n  require(\"!!../../../node_modules/extract-text-webpack-plugin/dist/loader.js?{\\\"omit\\\":1,\\\"remove\\\":true}!vue-style-loader!css-loader?{\\\"sourceMap\\\":true}!../../../node_modules/vue-loader/lib/style-compiler/index?{\\\"vue\\\":true,\\\"id\\\":\\\"data-v-06739cd5\\\",\\\"scoped\\\":false,\\\"hasInlineConfig\\\":false}!../../../node_modules/vue-loader/lib/selector?type=styles&index=0!./checkout.vue\")\n}\nvar normalizeComponent = require(\"!../../../node_modules/vue-loader/lib/component-normalizer\")\n/* script */\nexport * from \"!!babel-loader!../../../node_modules/vue-loader/lib/selector?type=script&index=0!./checkout.vue\"\nimport __vue_script__ from \"!!babel-loader!../../../node_modules/vue-loader/lib/selector?type=script&index=0!./checkout.vue\"\n/* template */\nimport __vue_template__ from \"!!../../../node_modules/vue-loader/lib/template-compiler/index?{\\\"id\\\":\\\"data-v-06739cd5\\\",\\\"hasScoped\\\":false,\\\"transformToRequire\\\":{\\\"video\\\":[\\\"src\\\",\\\"poster\\\"],\\\"source\\\":\\\"src\\\",\\\"img\\\":\\\"src\\\",\\\"image\\\":\\\"xlink:href\\\"},\\\"buble\\\":{\\\"transforms\\\":{}}}!../../../node_modules/vue-loader/lib/selector?type=template&index=0!./checkout.vue\"\n/* template functional */\nvar __vue_template_functional__ = false\n/* styles */\nvar __vue_styles__ = injectStyle\n/* scopeId */\nvar __vue_scopeId__ = null\n/* moduleIdentifier (server only) */\nvar __vue_module_identifier__ = null\nvar Component = normalizeComponent(\n  __vue_script__,\n  __vue_template__,\n  __vue_template_functional__,\n  __vue_styles__,\n  __vue_scopeId__,\n  __vue_module_identifier__\n)\n\nexport default Component.exports\n\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./src/pages/cart/checkout.vue\n// module id = null\n// module chunks = "],"sourceRoot":""}